#! /usr/bin/make -f
include /usr/share/dpkg/architecture.mk
include /usr/share/dpkg/pkg-info.mk

ifneq (,$(filter parallel=%,$(subst $(COMMA), ,$(DEB_BUILD_OPTIONS))))
  NJOBS := -j $(subst parallel=,,$(filter parallel=%,$(subst $(COMMA), ,$(DEB_BUILD_OPTIONS))))
endif

# Uncomment this to turn on verbose mode.
export DH_VERBOSE=1

SHELL=/bin/bash

PACKAGE=uasm

SRC_DIR_C = ./

# This has to be exported to make some magic below work.
export DH_OPTIONS

override_dh_auto_build:
	make $(NJOBS) -C $(SRC_DIR_C) -f ClangLinux64.mak INSTR=0 CFLAGS='-O3 -finline-functions -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=0' CPPFLAGS='' && make $(NJOBS) -C $(SRC_DIR_C) -f ClangLinux64.mak DEBUG=1 INSTR=0 CFLAGS='-g -O0 -fdebug-prefix-map=/<<PKGBUILDDIR>>=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2' CPPFLAGS=''

# empty override, fills example directory with lots of files
override_dh_auto_test:

override_dh_auto_clean:
	#$(MAKE) clean -C $(SRC_DIR_C) -f ClangLinux64.mak
	rm -rf GccUnixR
	rm -rf GccUnixD
	rm -rf debian/tmp

#override_dh_auto_install:
#	dh_auto_install

%:
	dh $@ --buildsystem=makefile
